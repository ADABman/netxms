/*
** System configuration table
*/

CREATE TABLE Config
(
	name varchar(64) not null,
	value varchar(255),
	PRIMARY KEY(name)
);


/*
** This table contains information about currently locked tables
** or subsystems
*/

CREATE TABLE Locks
(
	component_id integer not null,
	component_name varchar(64),
	lock_status integer not null,
	owner_info varchar(255),  // Information about current lock owner, may be empty
	PRIMARY KEY(component_id)
);


/*
** Users
*/

CREATE TABLE Users
(
	id integer not null,
	name varchar(64) not null,
	password varchar(48),
	access integer,
	PRIMARY KEY(id)
);


/*
** User groups
*/

CREATE TABLE UserGroups
(
	id integer not null,
	name varchar(64) not null,
	access integer,
	PRIMARY KEY(id)
);


/*
** Users to groups mapping
*/

CREATE TABLE UserGroupMembers
(
	group_id integer not null,
	user_id integer not null,
#ifdef DB_MYSQL
	KEY(group_id)
#endif
);


/*
** Nodes to be added
*/

CREATE TABLE NewNodes
(
	id integer not null,
	ip_addr integer not null,
	ip_netmask integer not null,
	discovery_flags integer not null
);


/*
** Nodes information
*/

CREATE TABLE Nodes
(
	id integer not null,
	name varchar(64),
	status integer,
	is_deleted integer not null,
	primary_ip integer,
	is_snmp integer,
	is_agent integer,
	is_bridge integer,
	is_router integer,
	is_local_mgmt integer,
	snmp_version integer,
	community varchar(32),
	snmp_oid varchar(255),
	discovery_flags integer,
	auth_method integer,
	secret varchar(64),
	agent_port integer,
	status_poll_type integer,
	inherit_access_rights integer,
	PRIMARY KEY(id)
);


/*
** Subnets
*/

CREATE TABLE Subnets
(
	id integer not null,
	name varchar(64),
	status integer,
	is_deleted integer not null,
	ip_addr integer,
	ip_netmask integer,
	PRIMARY KEY(id)
);


/*
** Nodes' interfaces
*/

CREATE TABLE Interfaces
(
	id integer not null,
	name varchar(64),
	status integer,
        is_deleted integer,
	node_id integer not null,
	ip_addr integer,
	ip_netmask integer,
	if_type integer,
	if_index integer,
	PRIMARY KEY(id),
#ifdef DB_MYSQL
	KEY(node_id)
#endif
);


/*
** Nodes to subnets mapping
*/

CREATE TABLE nsmap
(
	subnet_id integer not null,
	node_id integer not null,
#ifdef DB_MYSQL
	KEY (subnet_id)
#endif
);


/*
** Objects' ACLs
*/

CREATE TABLE acl
(
	object_id integer not null,
	user_id integer not null,
	access_rights integer not null,
#ifdef DB_MYSQL
	KEY(object_id)
#endif
);


/*
** Data collection items
*/

CREATE TABLE Items
(
	id integer not null,
	node_id integer not null,
	name varchar(255),
	description varchar(255),
	source integer,			// 0 for internal or 1 for native agent or 2 for SNMP
	datatype integer,
	polling_interval integer,
	retention_time integer,
	PRIMARY KEY(id),
#ifdef DB_MYSQL
	KEY(node_id)
#endif
);


/*
** Events configuration
*/

CREATE TABLE Events
(
	id integer not null,
	name varchar(64) not null,	// Short event name
	severity integer,
	flags integer,
	message varchar(255),		// Message template
	description DT_TEXT,
	PRIMARY KEY(id)
);


/*
** Event log
*/

CREATE TABLE EventLog
(
	event_id integer,
	timestamp integer,
	source integer,			// Source object ID
	severity integer,
	message varchar(255),
#ifdef DB_MYSQL
	KEY(event_id),
	KEY(timestamp)
#endif
);


/*
** Actions on events
*/

CREATE TABLE Actions
(
	action_id integer not null,
	action_type integer,
	email_addr varchar(255),
	email_subject varchar(255),
	// Field "action_data" holds message text for e-mail actions or
	// command line for external command execution actions
	action_data TEXT,
	PRIMARY KEY(action_id)
);


/*
** Node groups
*/

CREATE TABLE NodeGroups
(
	id integer not null,
	name varchar(64),
	description varchar(255),
	PRIMARY KEY(id)
);


/*
** Event groups
*/

CREATE TABLE EventGroups
(
	id integer not null,
	name varchar(64),
	description varchar(255),
	PRIMARY KEY(id)
);


/*
** Node group members
*/

CREATE TABLE NodeGroupMembers
(
	group_id integer not null,
	node_id integer not null,
	PRIMARY KEY(group_id,node_id)
);


/*
** Event group members
*/

CREATE TABLE EventGroupMembers
(
	group_id integer not null,
	event_id integer not null,
	PRIMARY KEY(group_id,event_id)
);


/*
** Event processing policy
*/

CREATE TABLE EventPolicy
(
	id integer not null,	// Rule number
	flags integer not null,
	comments varchar(255),
	PRIMARY KEY(id)
);

CREATE TABLE PolicySourceList
(
	rule_id integer not null,
	object_id integer not null,
	PRIMARY KEY(rule_id,object_id)
);

CREATE TABLE PolicyEventList
(
	rule_id integer not null,
	event_id integer not null,
	PRIMARY KEY(rule_id,event_id)
);

CREATE TABLE PolicyActionList
(
	rule_id integer not null,
	action_id integer not null,
	PRIMARY KEY(rule_id,action_id)
);


/*
** Deleted objects
*/

CREATE TABLE DeletedObjects
(
	object_id integer not null,
	object_class integer,
	name varchar(64),
	ip_addr integer,
	ip_netmask integer,
	PRIMARY KEY(object_id)
);
